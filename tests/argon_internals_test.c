#include "argon_core.h"
#include <stdbool.h>
#include "blake/blake.h"
#include <stdio.h>
#include <string.h>
#include <argon2d.h>
#include <argon2_mem.h>
#include <stdint.h>
#include <test.h>
#ifndef TESTING
#error "Testing macro is not defined"
#endif
extern uint8_t* createBuffer(argon_input_t *input);
extern argon_res_t compress(block_t *out, block_t *x, block_t *y);
extern void getIndexes(uint32_t i, uint32_t j, uint32_t i_pass, uint32_t i_slice, argon_input_t *p_input, argon_m_matrix_t memory, uint32_t *out_l, uint32_t *out_z);

extern argon_res_t argon2InternalHash(char *msg, uint32_t msg_len, uint8_t *out, uint32_t out_len);

// test if small inputs output the correct output
int testInternalHashSmallInput() {
    char* msg = "helloworld";
    uint8_t output[32];
    int res = argon2InternalHash(msg,  10, output, 32);
    uint8_t expected_out[32]= { 177, 195, 118, 98, 13, 181, 152, 23, 142, 106, 100, 136, 189, 195, 129, 135, 0, 207, 130, 52, 255, 165, 216, 55, 146, 10, 11, 209, 237, 137, 159, 134 };
    T_ASSERT(res == ARGON_RES_OK);
    for (int i = 0; i < 32; ++i) {
        T_ASSERT(output[i] == expected_out[i]);
    }
}

// test if large inputs output the correct output
int testInternalHashLargeInput() {
    char* msg = "helloworld";
    uint8_t output[128];
    int res = argon2InternalHash(msg,  10, output, 128);
    T_ASSERT(res == ARGON_RES_OK);
    uint8_t expected_out[128] = {76, 15, 44, 174, 90, 230, 28, 128, 77, 240, 166, 235, 239, 181, 176, 193, 145, 92, 173, 137, 37, 164, 10, 90, 46, 104, 15, 103, 111, 116, 40, 44, 103, 88, 150, 163, 191, 208, 24, 75, 241, 244, 59, 149, 49, 199, 129, 28, 140, 130, 89, 22, 203, 18, 217, 226, 128, 181, 169, 160, 226, 36, 224, 87, 73, 28, 195, 113, 8, 235, 250, 31, 7, 119, 114, 42, 2, 111, 47, 201, 175, 195, 35, 91, 174, 176, 138, 154, 131, 216, 170, 47, 193, 237, 157, 133, 177, 77, 225, 126, 53, 54, 143, 81, 94, 86, 237, 179, 12, 221, 88, 234, 121, 14, 221, 88, 46, 89, 212, 164, 200, 135, 252, 88, 100, 170, 65, 102};
    for (int i = 0; i < 128; ++i) {
        T_ASSERT(output[i] == expected_out[i]);
    }
    uint8_t output2[77];
    res = argon2InternalHash(msg,  10, output2, 77);
    T_ASSERT(res == ARGON_RES_OK);
    uint8_t expected_out2[77] = { 71, 51, 162, 124, 92, 14, 124, 35, 66, 228, 7, 178, 174, 210, 52, 202, 250, 132, 56, 25, 249, 186, 117, 137, 147, 149, 72, 122, 139, 247, 144, 27, 46, 39, 131, 0, 222, 54, 166, 13, 50, 253, 162, 215, 119, 135, 10, 178, 245, 18, 206, 195, 230, 181, 154, 120, 85, 245, 115, 163, 213, 249, 71, 30, 38, 65, 223, 135, 36, 235, 175, 193, 166, 24, 234, 179, 54 };
    for (int i = 0; i < 77; ++i) {
        T_ASSERT(output2[i] == expected_out2[i]);
    }
    return T_SUCCESS;
}

int testCreateMatrix() {
    argon_input_t input = {
        .parallelism = 3,
        .mem_size = 1024
    };
    argon_m_matrix_t matrix = argon2dAllocMatrix(&input);
    T_ASSERT(matrix.memory);
    T_ASSERT(matrix.row == 3);
    T_ASSERT(matrix.col == 340);
    return T_SUCCESS;
}
int testInitalHash() {
    argon_input_t input = {
        .parallelism = 3,
        .mem_size = 64,
        .passes = 16,
        .tag_length = 16,
        .salt = "saltiestsalt",
        .salt_len = 12,
        .message = "pass",
        .message_len = 4,
        .key_len = 0,
        .associated_data_len = 0
    };
    argon_m_matrix_t matrix = argon2dAllocMatrix(&input);
    argon2dInitalHash(&input, matrix);
    uint64_t expected_block1[BLOCK_SIZE / 8] = { 6889903770121239860llu, 11794529150601617313llu, 5543014328724340987, 1555259574500887524, 3998083734479517012, 3594962156781540080, 6956463789991707334, 3890237952853846135, 9430035265964054673llu, 17233544373208774397llu, 6230398660300646828, 17502044315039240294llu, 13903594468144412568llu, 6947596527790175523, 5648166752082424173, 7397286949408055243, 14283116997595318321llu, 16726762094984800547llu, 14811095569256345323llu, 18353197669071767531llu, 15890054197260941715llu, 2434452794863408651, 377780457136404609, 12141174266600507707llu, 3539516773770975738, 16135791241787394184llu, 1208572659149436337, 13437473459182459325llu, 8379405910324497920, 7333674308549194838, 1792052594275766152, 3855496953477851808, 8063352884662186078, 11986259096898121268llu, 6377349312821062612, 8175382910905662434, 13019917208682320107llu, 1821354090137850176, 17206006035458314024llu, 9163347567326590972, 12194372351248559471llu, 8486609663005832167, 10995108744305256387llu, 8506209305792177930, 11039384575573815510llu, 14125753019614405240llu, 629793572677144362, 2288010301127354904, 17253584804416330497llu, 18021310993446701738llu, 12881067809142259253llu, 6053317004541046952, 18301305351854820133llu, 7836502033532020449, 10985466012510929686llu, 13341096818434883290llu, 14395191861762203931llu, 1202730796046599231, 16936680034537033746llu, 4591642608787356697, 12569206604542657702llu, 3120252232675353570, 4011224346547693385, 10614747822897038107llu, 14624562016992088250llu, 13970256634110941186llu, 3412255760415233791, 8497258307389679832, 5469943972449118103, 16251503908179688297llu, 1943475050904255758, 4044089277133334626, 12548419004244757673llu, 14937693488319842092llu, 1485517420757328635, 4208206957123355584, 16305451708820950957llu, 4593612526562090513, 10068271481172088584llu, 17257117411837565970llu, 3651454622206212759, 3730967339009389261, 2749429044745845839, 5820023975037509705, 6087988906669008806, 16495474253568458327llu, 2556303722413972420, 9780128378570073870llu, 13380706554904490071llu, 12563819092291983024llu, 14326461782399995670llu, 9704700679388514953llu, 16010133479605348722llu, 5462283862063091664, 12014077491925282003llu, 1346607769761552826, 18134737687889501957llu, 5723859699306402238, 154534346651905555, 16796890227308556674llu, 4279842168269152975, 14535112875807017446llu, 2161515786909014301, 3280245999163197307, 7134286347115708428, 16213289383531758891llu, 3805419007320828714, 8754106906814445648, 11952997785402992249llu, 9090654248339478262, 14463302664118699318llu, 8260135413225770410, 15457342226918257605llu, 16333292212046539391llu, 2614206417901266231, 434822336377500148, 13921654730986355061llu, 10825114665520435967llu, 4137892629142732258, 16844611240185097323llu, 9263536167839549363llu, 2831837165957250472, 6731093485324623590, 12406126068416066897llu, 10375667925353353516llu, 9299063623279034650llu, 13675954331719229479llu, 3431533797955872151 };
    uint64_t expected_block2[BLOCK_SIZE / 8] = { 4633874154816894541llu, 9168260493809776811llu, 14618853492406694775llu, 6889676729068829656llu, 3728203770688233202llu, 17015321665785254658llu,453831180772235673llu,6279659005015072495llu,3615611055557111270llu,6588377527482016263llu,4717765793293474551llu,3004367421983306587llu,4696489353418886341llu,14364804318576241574llu,11544230907324111178llu,3255579961738256579llu,3013016017062349105llu,8009330136749980380llu,12610672315356435311llu,2447897205228943908llu,4280057026030696756llu,11095456838723882850llu,13761012139937017015llu,2352522775801780044llu,10949723223015206611llu,12927042471464653574llu,15299668440808122072llu,3306137091198793479llu,2769201307581422217llu,100012042469375314llu,14469987824450569070llu,962366044447468996llu,10615921871430190734llu,4448401526784969681llu,21417217112296501llu,7503593850619057997llu,15197623115708253300llu,3712941616351856493llu,2349773462774790976llu,16746738530471298820llu,14337216080914887536llu,13014869915856669738llu,16863159206212302236llu,5300891593119516124llu,9202433562638371027llu,8440985369170833914llu,11524212672694165789llu,16835778637724156412llu,223722979186526580llu,11876565393803580947llu,17807661570290568050llu,12199926685699591656llu,11649112934747762187llu,6359348718025474290llu,7979112974737701116llu,2961338954632336994llu,3069498760095666874llu,12060204555680775755llu,12950163205170550605llu,3849817333527855311llu,177467314481455815llu,12517450578334262917llu,16954502125310419975llu,15549848190901274179llu,7237095980224440856llu,11034988239274699677llu,13153125339563051448llu,2842231394887071272llu,7499142358843041827llu,6509313774566893955llu,17568984972817155119llu,4783990803600297549llu,669337120230163134llu,6225382254180899574llu,5413475224442736078llu,2382795770131456051llu,3157478891007267910llu,1332391150096248348llu,17702956577285574181llu,16773025153565713553llu,2137041568005294831llu,2149067111497178026llu,11225615831046652407llu,4520691724784160045llu,17206348753914667986llu,582902367408398724llu,13313704480060842692llu,18391580202102040307llu,17347335674268106550llu,13070698294109576378llu,16438263590871154117llu,12370285853381077726llu,11882833847781222554llu,16728698449299868061llu,4475377996502461130llu,5845339125221185484llu,9987907516069237571llu,13302271863151095325llu,15363989464977612221llu,4576311376919846190llu,3051918091958481914llu,10408335663359888426llu,9786580440245147410llu,7528120221966187752llu,10478091112151154894llu,8333038290661054269llu,17464761757077622184llu,14846072077143496457llu,13496683220932659927llu,16963439492272750733llu,7282346131411630801llu,12382889005646284684llu,1257331521040809221llu,10340763496360952306llu,18176882200883318568llu,4088265345027673668llu,15855002664170056595llu,5415036034790476057llu,9138325921749569044llu,12404319808660341996llu,6713569507037415066llu,4281493882226246969llu,13332404826154969528llu,3225652829248467307llu,8524460924856582427llu,3395702266034232179llu,5672202474419432429llu,7509370083338497790llu };
    for (int i = 0;   i < (BLOCK_SIZE / 8); ++i) {
        T_ASSERT(matrix.memory[0].v[i] == expected_block1[i]);
        T_ASSERT(matrix.memory[1].v[i] == expected_block2[i]);
    }
    return T_SUCCESS;
}
// tests to see if the argon compression function works
int testCompression() {
    block_t out;
    block_t x;
    block_t y;
    for (int i = 0; i < 1024; ++i) {
        x.b[i] = 128;
        y.b[i] =  64;
    }
    uint8_t expected_out[1024] = { 153, 173, 70, 255, 178, 180, 45, 60, 153, 173, 70, 255, 178, 180, 45, 60, 153, 173, 70, 255, 178, 180, 45, 60, 153, 173, 70, 255, 178, 180, 45, 60, 69, 17, 166, 26, 176, 35, 153, 224, 69, 17, 166, 26, 176, 35, 153, 224, 69, 17, 166, 26, 176, 35, 153, 224, 69, 17, 166, 26, 176, 35, 153, 224, 43, 245, 212, 120, 102, 28, 132, 243, 43, 245, 212, 120, 102, 28, 132, 243, 43, 245, 212, 120, 102, 28, 132, 243, 43, 245, 212, 120, 102, 28, 132, 243, 248, 68, 184, 96, 247, 31, 79, 97, 248, 68, 184, 96, 247, 31, 79, 97, 248, 68, 184, 96, 247, 31, 79, 97, 248, 68, 184, 96, 247, 31, 79, 97, 153, 173, 70, 255, 178, 180, 45, 60, 153, 173, 70, 255, 178, 180, 45, 60, 153, 173, 70, 255, 178, 180, 45, 60, 153, 173, 70, 255, 178, 180, 45, 60, 69, 17, 166, 26, 176, 35, 153, 224, 69, 17, 166, 26, 176, 35, 153, 224, 69, 17, 166, 26, 176, 35, 153, 224, 69, 17, 166, 26, 176, 35, 153, 224, 43, 245, 212, 120, 102, 28, 132, 243, 43, 245, 212, 120, 102, 28, 132, 243, 43, 245, 212, 120, 102, 28, 132, 243, 43, 245, 212, 120, 102, 28, 132, 243, 248, 68, 184, 96, 247, 31, 79, 97, 248, 68, 184, 96, 247, 31, 79, 97, 248, 68, 184, 96, 247, 31, 79, 97, 248, 68, 184, 96, 247, 31, 79, 97, 35, 0, 229, 216, 185, 235, 77, 180, 35, 0, 229, 216, 185, 235, 77, 180, 35, 0, 229, 216, 185, 235, 77, 180, 35, 0, 229, 216, 185, 235, 77, 180, 173, 198, 214, 162, 232, 46, 42, 0, 173, 198, 214, 162, 232, 46, 42, 0, 173, 198, 214, 162, 232, 46, 42, 0, 173, 198, 214, 162, 232, 46, 42, 0, 89, 20, 83, 173, 20, 74, 121, 93, 89, 20, 83, 173, 20, 74, 121, 93, 89, 20, 83, 173, 20, 74, 121, 93, 89, 20, 83, 173, 20, 74, 121, 93, 80, 3, 85, 4, 50, 24, 67, 128, 80, 3, 85, 4, 50, 24, 67, 128, 80, 3, 85, 4, 50, 24, 67, 128, 80, 3, 85, 4, 50, 24, 67, 128, 35, 0, 229, 216, 185, 235, 77, 180, 35, 0, 229, 216, 185, 235, 77, 180, 35, 0, 229, 216, 185, 235, 77, 180, 35, 0, 229, 216, 185, 235, 77, 180, 173, 198, 214, 162, 232, 46, 42, 0, 173, 198, 214, 162, 232, 46, 42, 0, 173, 198, 214, 162, 232, 46, 42, 0, 173, 198, 214, 162, 232, 46, 42, 0, 89, 20, 83, 173, 20, 74, 121, 93, 89, 20, 83, 173, 20, 74, 121, 93, 89, 20, 83, 173, 20, 74, 121, 93, 89, 20, 83, 173, 20, 74, 121, 93, 80, 3, 85, 4, 50, 24, 67, 128, 80, 3, 85, 4, 50, 24, 67, 128, 80, 3, 85, 4, 50, 24, 67, 128, 80, 3, 85, 4, 50, 24, 67, 128, 202, 204, 176, 162, 95, 103, 87, 14, 202, 204, 176, 162, 95, 103, 87, 14, 202, 204, 176, 162, 95, 103, 87, 14, 202, 204, 176, 162, 95, 103, 87, 14, 245, 135, 227, 108, 125, 222, 171, 82, 245, 135, 227, 108, 125, 222, 171, 82, 245, 135, 227, 108, 125, 222, 171, 82, 245, 135, 227, 108, 125, 222, 171, 82, 94, 56, 141, 122, 115, 83, 221, 65, 94, 56, 141, 122, 115, 83, 221, 65, 94, 56, 141, 122, 115, 83, 221, 65, 94, 56, 141, 122, 115, 83, 221, 65, 230, 95, 78, 59, 161, 126, 9, 88, 230, 95, 78, 59, 161, 126, 9, 88, 230, 95, 78, 59, 161, 126, 9, 88, 230, 95, 78, 59, 161, 126, 9, 88, 202, 204, 176, 162, 95, 103, 87, 14, 202, 204, 176, 162, 95, 103, 87, 14, 202, 204, 176, 162, 95, 103, 87, 14, 202, 204, 176, 162, 95, 103, 87, 14, 245, 135, 227, 108, 125, 222, 171, 82, 245, 135, 227, 108, 125, 222, 171, 82, 245, 135, 227, 108, 125, 222, 171, 82, 245, 135, 227, 108, 125, 222, 171, 82, 94, 56, 141, 122, 115, 83, 221, 65, 94, 56, 141, 122, 115, 83, 221, 65, 94, 56, 141, 122, 115, 83, 221, 65, 94, 56, 141, 122, 115, 83, 221, 65, 230, 95, 78, 59, 161, 126, 9, 88, 230, 95, 78, 59, 161, 126, 9, 88, 230, 95, 78, 59, 161, 126, 9, 88, 230, 95, 78, 59, 161, 126, 9, 88, 230, 63, 33, 217, 51, 9, 166, 55, 230, 63, 33, 217, 51, 9, 166, 55, 230, 63, 33, 217, 51, 9, 166, 55, 230, 63, 33, 217, 51, 9, 166, 55, 125, 117, 192, 47, 212, 110, 162, 204, 125, 117, 192, 47, 212, 110, 162, 204, 125, 117, 192, 47, 212, 110, 162, 204, 125, 117, 192, 47, 212, 110, 162, 204, 159, 233, 26, 189, 36, 230, 15, 117, 159, 233, 26, 189, 36, 230, 15, 117, 159, 233, 26, 189, 36, 230, 15, 117, 159, 233, 26, 189, 36, 230, 15, 117, 213, 127, 45, 105, 178, 152, 128, 216, 213, 127, 45, 105, 178, 152, 128, 216, 213, 127, 45, 105, 178, 152, 128, 216, 213, 127, 45, 105, 178, 152, 128, 216, 230, 63, 33, 217, 51, 9, 166, 55, 230, 63, 33, 217, 51, 9, 166, 55, 230, 63, 33, 217, 51, 9, 166, 55, 230, 63, 33, 217, 51, 9, 166, 55, 125, 117, 192, 47, 212, 110, 162, 204, 125, 117, 192, 47, 212, 110, 162, 204, 125, 117, 192, 47, 212, 110, 162, 204, 125, 117, 192, 47, 212, 110, 162, 204, 159, 233, 26, 189, 36, 230, 15, 117, 159, 233, 26, 189, 36, 230, 15, 117, 159, 233, 26, 189, 36, 230, 15, 117, 159, 233, 26, 189, 36, 230, 15, 117, 213, 127, 45, 105, 178, 152, 128, 216, 213, 127, 45, 105, 178, 152, 128, 216, 213, 127, 45, 105, 178, 152, 128, 216, 213, 127, 45, 105, 178, 152, 128, 216 };
    argon_res_t res = compress(&out, &x, &y);
    T_ASSERT(res == ARGON_RES_OK);
    for (int i = 0; i < 1024; i++) {
        T_ASSERT(expected_out[i] == out.b[i])
    }
    return T_SUCCESS;
}
int testHashRemaining() {
    uint32_t i = 1;
    uint32_t j = 1;
    uint32_t l;
    uint32_t z;
    argon_input_t in = {
        .parallelism = 4,
        .mem_size = 20,
        .passes = 2,
        .outlen = 1
    };
    argon_m_matrix_t mem = argon2dAllocMatrix(&in);
    for (int i = 0; i < mem.col * mem.row; ++i) {
        memset(mem.memory[i].v, 0, 128 );
    }
    T_ASSERT(mem.col == 4);
    T_ASSERT(mem.row == 4);
    mem.memory[0].v[0] = 1;
    argon_res_t res;
    res = argon2dHashRemaining(&in, mem);
    uint8_t expected_out[1024] = {57, 179, 156, 125, 74, 147, 96, 194, 224, 65, 0, 86, 200, 126, 173, 96, 223, 237, 118, 76, 162, 156, 95, 138, 230, 214, 101, 200, 170, 53, 239, 91, 96, 15, 113, 247, 81, 165, 178, 204, 241, 133, 103, 200, 73, 140, 217, 22, 21, 93, 145, 147, 176, 61, 109, 6, 80, 168, 197, 98, 43, 211, 116, 57, 139, 246, 249, 88, 45, 159, 17, 213, 98, 212, 112, 214, 41, 167, 135, 234, 97, 221, 246, 54, 214, 101, 233, 180, 244, 162, 193, 74, 11, 188, 36, 72, 74, 131, 134, 162, 123, 255, 243, 147, 3, 95, 37, 60, 218, 223, 222, 135, 121, 143, 220, 204, 185, 88, 220, 120, 77, 38, 179, 109, 183, 74, 129, 219, 246, 28, 29, 131, 206, 16, 80, 83, 93, 228, 182, 45, 88, 160, 207, 39, 247, 23, 115, 189, 34, 242, 52, 216, 143, 145, 141, 163, 113, 68, 47, 107, 229, 104, 20, 210, 123, 218, 35, 213, 230, 129, 205, 92, 112, 229, 124, 183, 149, 77, 5, 64, 121, 63, 91, 86, 94, 57, 182, 214, 116, 181, 146, 174, 130, 151, 48, 249, 147, 139, 78, 235, 107, 233, 175, 96, 150, 60, 68, 254, 78, 170, 157, 65, 245, 217, 235, 13, 124, 82, 107, 126, 46, 1, 192, 216, 107, 42, 38, 23, 59, 12, 196, 211, 99, 230, 203, 100, 88, 183, 14, 0, 119, 156, 47, 125, 240, 40, 115, 123, 55, 227, 130, 210, 1, 84, 174, 149, 140, 70, 91, 184, 50, 196, 105, 161, 203, 245, 119, 98, 83, 202, 196, 66, 116, 11, 6, 136, 203, 204, 118, 14, 104, 103, 83, 94, 228, 239, 48, 189, 2, 131, 5, 216, 168, 238, 236, 46, 214, 207, 164, 104, 173, 249, 186, 227, 124, 68, 122, 33, 151, 237, 79, 206, 67, 194, 121, 188, 163, 246, 174, 2, 201, 151, 171, 150, 13, 195, 254, 29, 156, 133, 13, 200, 208, 140, 32, 128, 41, 198, 92, 14, 45, 55, 25, 5, 16, 181, 111, 82, 165, 250, 225, 139, 106, 88, 24, 63, 154, 28, 102, 179, 16, 86, 225, 34, 222, 6, 15, 176, 130, 202, 208, 231, 20, 150, 58, 137, 146, 5, 158, 151, 216, 68, 71, 0, 92, 189, 63, 250, 64, 177, 128, 10, 21, 242, 31, 89, 108, 17, 138, 106, 22, 66, 191, 8, 18, 22, 72, 143, 35, 41, 176, 187, 51, 138, 27, 119, 60, 50, 55, 243, 209, 143, 115, 183, 247, 191, 89, 23, 213, 141, 158, 114, 130, 137, 211, 36, 174, 14, 40, 96, 147, 81, 237, 28, 75, 134, 2, 230, 197, 219, 89, 128, 131, 159, 152, 68, 177, 106, 169, 16, 135, 28, 140, 81, 31, 217, 72, 156, 211, 221, 132, 92, 31, 81, 117, 134, 39, 142, 128, 100, 144, 52, 209, 38, 159, 157, 169, 232, 209, 142, 208, 191, 193, 206, 195, 84, 44, 27, 96, 66, 77, 130, 200, 244, 11, 21, 181, 206, 225, 52, 137, 145, 141, 56, 192, 249, 0, 182, 241, 211, 132, 128, 14, 47, 52, 109, 4, 97, 190, 16, 125, 55, 120, 218, 26, 233, 173, 19, 61, 74, 122, 37, 205, 167, 184, 99, 207, 113, 49, 165, 3, 126, 105, 254, 85, 165, 94, 164, 200, 126, 205, 59, 189, 158, 13, 28, 36, 70, 192, 158, 84, 105, 101, 25, 25, 225, 139, 228, 69, 179, 87, 163, 113, 220, 118, 128, 197, 230, 185, 56, 205, 169, 71, 85, 181, 95, 188, 2, 164, 114, 110, 177, 218, 122, 148, 134, 92, 255, 2, 119, 180, 131, 226, 92, 159, 223, 26, 170, 140, 56, 159, 14, 63, 148, 101, 14, 151, 255, 126, 240, 46, 6, 202, 215, 91, 120, 189, 117, 154, 129, 52, 1, 49, 54, 236, 131, 81, 101, 41, 166, 209, 133, 110, 8, 245, 180, 210, 77, 42, 247, 53, 141, 156, 171, 200, 213, 194, 139, 194, 3, 21, 121, 73, 6, 217, 100, 215, 15, 149, 115, 158, 135, 113, 60, 162, 72, 7, 82, 61, 194, 152, 134, 31, 154, 184, 59, 172, 8, 145, 210, 30, 83, 6, 142, 93, 109, 111, 111, 155, 244, 116, 17, 246, 49, 240, 246, 1, 54, 35, 148, 174, 12, 1, 166, 117, 214, 84, 246, 41, 238, 237, 243, 186, 213, 17, 30, 149, 227, 24, 89, 110, 9, 165, 225, 15, 143, 48, 81, 192, 160, 203, 69, 9, 138, 59, 81, 236, 130, 80, 139, 242, 227, 168, 53, 210, 52, 78, 51, 88, 133, 182, 124, 136, 238, 4, 235, 26, 97, 243, 59, 24, 97, 17, 221, 33, 57, 111, 11, 86, 151, 119, 77, 161, 119, 21, 237, 12, 107, 39, 118, 149, 176, 83, 67, 220, 93, 9, 117, 7, 199, 246, 147, 171, 150, 187, 247, 39, 183, 61, 190, 107, 102, 171, 254, 34, 209, 229, 171, 35, 10, 239, 81, 193, 1, 147, 197, 142, 110, 106, 210, 245, 106, 180, 226, 23, 196, 212, 61, 54, 5, 170, 190, 234, 104, 176, 155, 183, 67, 25, 59, 243, 106, 34, 113, 52, 246, 41, 217, 183, 84, 32, 174, 133, 205, 102, 192, 123, 150, 55, 66, 126, 149, 92, 43, 244, 200, 232, 209, 229, 140, 216, 213, 153, 159, 96, 202, 46, 142, 6, 57, 229, 162, 30, 64, 96, 130, 59, 29, 200, 244, 248, 230, 104, 129, 141, 10, 2, 29, 96, 40, 240, 62, 49, 127, 232, 8, 118, 226, 207, 20, 87, 37, 105, 244, 163, 253, 50, 116, 197, 58, 132, 169, 125, 235, 240, 195, 252, 147, 200, 68, 143, 228, 174, 216, 89, 181, 194, 105, 87, 245, 140, 110, 6, 80, 25, 85, 148, 87, 204, 147, 64, 71, 185, 47, 223, 160, 237, 66, 51, 115, 37, 142, 162, 1, 204, 196, 98, 58, 83, 242, 224, 169, 217, 237, 252, 46, 143, 167, 227, 228, 189, 60, 142, 191, 198, 16, 21, 19, 188, 57, 201, 221, 84, 219, 122, 64, 47, 232, 61, 94, 66, 185, 210, 199, };
    for (int i = 0; i < BLOCK_SIZE; i++) {
        T_ASSERT(expected_out[i] == mem.memory[0].b[i]);
    }
    return T_SUCCESS;
}

int testArgonOutput() {
    argon_input_t in = {
        .parallelism = 4,
        .mem_size = 32,
        .outlen = 64,
        .key = NULL,
        .key_len = 0,
        .message = "hello",
        .message_len = 5,
        .salt = "1234567890123456",
        .salt_len = 16,
        .associated_data = NULL,
        .associated_data_len = 0,
        .passes = 2,
    };
    argon_m_matrix_t mem = argon2dAllocMatrix(&in);
    argon_res_t res;
    argon2dInitalHash(&in, mem);
    uint8_t a[BLOCK_SIZE] = { 170, 64, 213, 198, 60, 93, 119, 225, 254, 203, 85, 212, 180, 74, 150, 211, 100, 133, 8, 10, 30, 98, 7, 92, 148, 255, 164, 124, 80, 224, 97, 234, 78, 255, 108, 165, 198, 210, 46, 228, 149, 255, 69, 214, 231, 37, 105, 58, 10, 165, 39, 248, 249, 240, 119, 176, 187, 51, 205, 81, 123, 207, 111, 111, 36, 72, 159, 226, 244, 197, 148, 217, 64, 111, 189, 209, 211, 105, 91, 160, 108, 240, 174, 202, 125, 219, 25, 198, 55, 102, 34, 64, 95, 151, 162, 90, 173, 211, 153, 154, 61, 148, 148, 96, 254, 237, 192, 117, 230, 184, 82, 147, 206, 121, 0, 236, 124, 60, 241, 136, 245, 214, 27, 180, 141, 123, 51, 127, 1, 77, 3, 218, 14, 130, 248, 199, 158, 75, 14, 135, 4, 192, 221, 111, 114, 251, 204, 209, 42, 15, 212, 96, 141, 247, 148, 174, 8, 30, 23, 156, 191, 185, 34, 242, 176, 138, 57, 139, 248, 243, 96, 80, 148, 188, 97, 229, 118, 83, 228, 150, 0, 16, 39, 169, 131, 116, 64, 32, 67, 71, 38, 33, 250, 47, 126, 31, 35, 50, 251, 215, 49, 31, 248, 44, 89, 189, 200, 57, 72, 167, 219, 155, 77, 163, 101, 76, 39, 114, 48, 99, 18, 200, 8, 65, 99, 131, 20, 66, 43, 246, 136, 24, 171, 146, 100, 238, 48, 67, 108, 115, 30, 88, 212, 221, 122, 113, 62, 255, 185, 118, 17, 216, 11, 34, 31, 29, 239, 13, 118, 37, 148, 36, 54, 248, 139, 206, 18, 134, 197, 128, 68, 24, 1, 25, 117, 213, 204, 170, 131, 86, 224, 220, 182, 205, 245, 2, 147, 120, 55, 198, 60, 221, 94, 66, 161, 117, 238, 98, 51, 233, 44, 90, 135, 55, 188, 79, 114, 5, 144, 48, 23, 146, 193, 34, 18, 250, 22, 126, 145, 141, 32, 20, 79, 20, 248, 202, 51, 41, 80, 99, 251, 5, 58, 91, 255, 46, 81, 223, 9, 54, 74, 74, 234, 175, 94, 55, 128, 176, 89, 10, 7, 125, 200, 123, 173, 248, 181, 209, 237, 231, 101, 124, 149, 109, 214, 94, 7, 190, 55, 107, 196, 206, 125, 149, 95, 161, 96, 98, 108, 152, 244, 211, 64, 48, 236, 186, 131, 86, 94, 133, 240, 134, 65, 199, 155, 39, 159, 101, 15, 127, 0, 121, 22, 219, 51, 135, 81, 126, 114, 67, 2, 29, 27, 17, 213, 89, 70, 16, 179, 7, 41, 55, 111, 72, 196, 99, 210, 70, 145, 152, 118, 53, 159, 158, 226, 144, 84, 160, 239, 117, 71, 215, 1, 175, 239, 48, 230, 58, 111, 83, 138, 154, 169, 101, 253, 179, 250, 4, 147, 38, 216, 185, 173, 198, 145, 21, 125, 74, 21, 3, 40, 169, 0, 179, 188, 198, 38, 116, 246, 2, 177, 25, 40, 170, 143, 174, 37, 11, 78, 179, 209, 181, 171, 159, 158, 7, 106, 111, 207, 71, 32, 79, 117, 97, 231, 118, 27, 226, 85, 86, 110, 101, 235, 167, 47, 214, 129, 15, 215, 186, 61, 42, 50, 168, 43, 41, 167, 103, 131, 113, 139, 9, 207, 15, 115, 197, 69, 47, 237, 244, 233, 89, 7, 77, 96, 130, 12, 33, 142, 214, 247, 49, 50, 20, 52, 47, 22, 98, 11, 186, 141, 29, 76, 230, 4, 233, 197, 182, 19, 171, 164, 151, 189, 173, 219, 96, 99, 232, 61, 93, 101, 97, 3, 64, 251, 34, 234, 88, 178, 72, 232, 235, 58, 168, 59, 140, 67, 109, 195, 12, 110, 157, 209, 54, 226, 6, 169, 248, 182, 150, 23, 31, 183, 200, 177, 27, 82, 40, 195, 240, 170, 231, 36, 153, 61, 48, 176, 247, 230, 57, 148, 188, 254, 6, 179, 195, 125, 162, 97, 22, 220, 101, 103, 187, 127, 162, 255, 149, 184, 227, 24, 156, 54, 91, 170, 228, 140, 160, 163, 188, 73, 210, 160, 150, 194, 146, 109, 28, 183, 174, 31, 94, 140, 216, 29, 44, 158, 173, 89, 75, 230, 218, 114, 138, 193, 3, 65, 195, 149, 63, 55, 61, 210, 8, 104, 11, 77, 93, 194, 240, 153, 32, 7, 10, 199, 104, 150, 254, 148, 169, 249, 253, 17, 104, 79, 232, 127, 245, 93, 12, 210, 75, 32, 246, 28, 162, 31, 23, 197, 42, 248, 138, 118, 9, 163, 42, 203, 35, 63, 187, 150, 28, 61, 200, 246, 122, 251, 230, 54, 17, 118, 248, 227, 102, 148, 151, 4, 150, 240, 109, 41, 209, 53, 226, 210, 230, 73, 156, 255, 169, 244, 210, 59, 148, 94, 164, 112, 137, 168, 60, 237, 108, 95, 218, 121, 251, 17, 106, 166, 202, 160, 110, 162, 74, 67, 135, 186, 6, 77, 143, 47, 77, 15, 167, 76, 212, 142, 103, 193, 7, 112, 30, 92, 206, 102, 54, 207, 118, 136, 117, 154, 61, 139, 247, 69, 53, 184, 66, 110, 153, 80, 39, 129, 158, 7, 13, 18, 163, 60, 105, 231, 127, 19, 115, 163, 192, 214, 226, 246, 245, 166, 82, 72, 59, 118, 25, 180, 131, 88, 84, 198, 241, 87, 105, 6, 78, 121, 174, 96, 165, 48, 248, 184, 92, 125, 118, 223, 94, 31, 112, 191, 42, 241, 183, 12, 16, 107, 118, 109, 81, 239, 215, 226, 32, 254, 201, 153, 167, 15, 142, 17, 187, 36, 13, 137, 184, 253, 235, 65, 55, 238, 116, 176, 72, 64, 192, 114, 15, 236, 200, 157, 10, 13, 11, 76, 199, 153, 131, 79, 53, 128, 206, 52, 219, 136, 1, 9, 50, 245, 70, 162, 232, 46, 174, 80, 23, 12, 13, 153, 138, 63, 188, 246, 181, 81, 202, 100, 119, 8, 113, 28, 27, 252, 252, 21, 114, 125, 74, 254, 38, 187, 127, 188, 41, 197, 138, 11, 182, 188, 85, 229, 221, 121, 193, 58, 175, 104, 255, 169, 77, 39, 162, 253, 186, 15, 75, 38, 254, 194, 164, 0, 253, 81, 183, 130, 193, 42, 32, 118, 186, 126, 84, 43, 166, 252, 64, 39, 93, 22, 189, 144, 29, 146, 222, };
    uint8_t b[BLOCK_SIZE] = {216,124,3,246,118,169,49,110,31,89,28,90,146,9,76,34,238,182,145,15,88,56,49,167,142,25,175,123,185,14,217,167,109,107,214,97,186,133,162,179,32,162,172,74,229,213,99,143,229,200,72,197,231,180,77,135,145,204,111,97,22,186,48,239,254,38,107,184,30,90,98,252,87,241,206,219,254,205,62,82,44,51,123,38,168,122,236,28,146,208,168,37,95,188,234,63,195,101,50,215,243,208,234,223,118,156,36,88,152,144,107,40,204,187,68,253,170,131,161,37,138,92,6,93,11,8,212,164,124,57,172,5,152,202,55,2,143,70,157,112,116,121,108,19,238,53,16,207,76,209,95,156,75,222,228,106,59,204,13,27,79,148,254,238,91,151,194,106,91,126,146,14,170,49,50,244,43,16,110,233,247,64,162,59,249,21,67,138,157,218,37,95,151,251,95,106,208,31,250,114,122,203,52,20,92,201,222,129,20,71,67,28,123,243,118,88,62,157,185,171,154,4,97,237,160,5,190,236,221,136,10,59,140,58,229,163,15,87,196,49,163,187,115,79,145,228,143,83,143,128,44,174,106,103,83,157,53,9,212,219,151,8,93,87,12,104,44,72,250,167,91,113,125,198,64,204,78,79,172,42,152,212,215,58,28,188,23,54,222,48,190,7,151,37,34,228,31,158,78,109,83,250,40,100,250,205,98,180,88,209,176,167,86,235,249,231,252,72,200,243,189,189,65,128,27,209,195,69,186,99,132,57,13,227,92,203,215,117,13,224,12,171,165,167,67,205,212,106,49,49,208,164,234,67,29,31,51,61,164,156,152,4,68,164,183,112,190,58,74,138,185,159,133,25,98,9,233,219,253,58,62,27,6,89,102,254,104,236,96,111,65,37,141,130,82,255,47,124,4,32,244,149,245,245,183,86,179,251,185,216,5,56,242,77,157,31,199,19,162,60,151,120,51,209,40,127,63,28,17,79,30,214,210,22,226,88,97,227,154,102,215,174,86,228,33,177,50,237,11,85,224,167,184,163,131,90,206,166,181,50,147,20,6,194,148,80,213,254,8,233,45,136,80,101,111,68,120,97,141,219,57,138,82,230,209,97,187,18,90,181,192,252,185,139,61,151,121,27,225,220,228,97,192,22,250,194,152,14,161,220,40,77,71,159,165,65,101,152,19,166,164,239,246,156,113,253,79,72,9,202,56,183,16,205,161,97,31,246,133,164,249,136,58,179,225,201,120,170,115,107,199,54,193,8,243,196,20,96,11,89,102,58,166,230,78,163,106,120,204,156,43,190,18,249,62,144,186,138,212,161,20,16,10,210,34,187,181,240,130,57,64,168,30,46,35,73,121,44,108,218,121,152,33,140,24,130,112,170,125,44,171,173,251,183,89,244,240,231,44,11,53,230,109,47,114,146,211,79,192,205,104,164,11,178,201,128,75,179,196,36,33,83,31,53,146,207,36,249,100,237,119,81,143,55,0,160,110,169,14,133,199,155,26,61,203,224,227,208,243,53,195,167,243,140,46,57,200,196,220,49,27,147,120,148,199,186,186,163,61,190,160,14,221,142,61,18,204,41,168,172,142,199,113,194,60,230,29,8,40,158,185,61,14,118,199,89,29,195,76,51,245,41,37,153,116,97,116,77,247,59,49,16,13,155,61,237,124,101,250,99,81,232,216,57,93,152,248,79,16,136,1,97,158,169,18,120,78,147,113,125,126,36,158,136,255,210,209,198,14,214,130,139,72,126,133,169,48,109,129,70,46,195,79,114,131,59,245,87,127,125,70,141,107,111,155,61,110,164,133,171,198,137,65,241,10,24,113,76,133,13,145,18,173,29,228,255,179,87,197,248,224,10,173,86,19,77,162,127,28,204,198,79,247,113,96,127,44,230,194,251,149,53,170,214,83,66,158,177,228,17,130,217,58,121,202,100,63,190,110,31,44,37,225,86,219,14,223,181,52,38,253,4,192,220,114,185,139,38,214,220,94,101,229,90,113,228,7,119,107,227,39,73,206,234,189,23,10,53,61,110,177,184,139,108,94,220,199,25,147,72,119,52,41,47,70,175,53,151,56,195,184,161,206,81,4,231,116,115,240,8,136,129,161,55,108,103,241,189,114,253,163,31,2,43,56,132,87,221,165,132,90,86,167,58,145,33,202,28,156,252,31,154,123,59,34,17,89,236,85,102,144,250,16,53,204,163,4,45,133,108,178,1,176,89,160,96,34,231,145,15,54,224,151,33,31,197,209,152,150,147,47,223,141,101,19,229,53,150,198,171,231,203,165,21,19,147,142,85,164,61,96,95,68,243};
    uint8_t c[BLOCK_SIZE] = {237, 134, 103, 198, 130, 200, 3, 164, 78, 222, 239, 32, 118, 236, 161, 106, 97, 75, 204, 165, 32, 183, 167, 129, 13, 131, 133, 206, 129, 223, 230, 246, 105, 120, 246, 68, 163, 254, 209, 203, 178, 41, 85, 45, 39, 234, 88, 191, 181, 130, 79, 29, 37, 188, 54, 23, 159, 43, 126, 44, 125, 175, 221, 121, 86, 32, 145, 59, 185, 128, 230, 88, 8, 91, 118, 53, 156, 125, 180, 216, 4, 201, 230, 108, 126, 69, 226, 217, 6, 121, 161, 146, 56, 34, 155, 30, 215, 45, 12, 133, 65, 43, 4, 89, 184, 19, 153, 202, 169, 245, 42, 66, 200, 33, 168, 30, 64, 192, 99, 148, 22, 40, 239, 185, 239, 190, 178, 111, 14, 228, 104, 226, 167, 10, 153, 18, 130, 110, 132, 216, 199, 208, 255, 249, 170, 190, 64, 215, 76, 17, 134, 183, 115, 82, 56, 162, 106, 5, 96, 5, 205, 129, 214, 239, 230, 96, 114, 143, 184, 9, 5, 185, 216, 105, 221, 187, 222, 170, 4, 148, 249, 112, 64, 122, 62, 119, 128, 163, 19, 161, 134, 171, 155, 171, 100, 92, 159, 153, 18, 226, 25, 200, 39, 94, 56, 147, 51, 137, 159, 201, 52, 199, 194, 223, 19, 82, 117, 234, 98, 63, 154, 8, 87, 123, 157, 46, 14, 93, 37, 220, 167, 46, 132, 145, 145, 25, 180, 76, 142, 23, 228, 5, 25, 156, 42, 197, 65, 16, 123, 145, 165, 157, 101, 39, 14, 255, 66, 66, 239, 24, 143, 169, 231, 140, 71, 121, 1, 89, 114, 60, 79, 27, 186, 222, 45, 174, 144, 56, 165, 73, 124, 175, 141, 17, 140, 9, 114, 113, 15, 34, 145, 165, 84, 97, 79, 169, 247, 221, 70, 48, 151, 89, 244, 120, 31, 201, 228, 238, 127, 227, 194, 222, 45, 19, 220, 186, 26, 132, 73, 62, 249, 202, 71, 14, 65, 237, 240, 137, 33, 37, 44, 69, 110, 202, 195, 227, 33, 131, 211, 76, 77, 229, 13, 69, 115, 54, 115, 98, 49, 146, 181, 111, 82, 190, 10, 195, 110, 221, 227, 3, 198, 175, 115, 17, 203, 192, 209, 102, 217, 31, 232, 33, 123, 41, 80, 252, 21, 9, 189, 44, 194, 212, 61, 216, 66, 24, 169, 138, 165, 246, 163, 54, 67, 29, 195, 162, 30, 158, 44, 187, 143, 213, 209, 143, 33, 136, 73, 77, 249, 241, 210, 249, 163, 190, 248, 153, 207, 32, 46, 214, 182, 240, 109, 219, 17, 244, 60, 3, 194, 161, 121, 76, 240, 85, 101, 121, 133, 91, 84, 130, 233, 30, 100, 128, 63, 205, 86, 208, 104, 112, 44, 62, 177, 96, 45, 33, 218, 57, 136, 246, 18, 133, 45, 7, 218, 171, 162, 91, 127, 139, 149, 129, 203, 244, 36, 122, 219, 92, 153, 250, 87, 189, 117, 70, 91, 177, 210, 182, 50, 181, 136, 127, 147, 136, 163, 176, 6, 165, 169, 140, 111, 232, 173, 159, 167, 238, 67, 255, 50, 199, 16, 60, 216, 202, 214, 43, 107, 154, 80, 12, 92, 178, 226, 228, 16, 63, 203, 91, 15, 21, 71, 124, 72, 143, 197, 143, 238, 149, 38, 119, 215, 143, 211, 134, 88, 56, 186, 228, 37, 90, 118, 107, 171, 251, 186, 169, 155, 242, 19, 230, 216, 148, 180, 99, 47, 71, 55, 250, 212, 175, 212, 90, 79, 52, 209, 5, 183, 190, 213, 255, 148, 26, 59, 237, 40, 147, 106, 181, 218, 50, 191, 38, 134, 234, 254, 55, 218, 82, 157, 94, 9, 211, 194, 72, 0, 119, 16, 153, 112, 52, 17, 94, 176, 216, 116, 222, 61, 95, 229, 232, 67, 213, 216, 149, 244, 164, 61, 107, 44, 135, 157, 232, 87, 131, 152, 170, 157, 109, 59, 45, 178, 141, 106, 78, 189, 18, 155, 204, 149, 132, 68, 61, 11, 23, 67, 185, 90, 74, 110, 28, 219, 65, 87, 99, 187, 115, 242, 90, 107, 60, 203, 59, 145, 26, 174, 49, 195, 62, 223, 41, 206, 142, 116, 112, 12, 103, 227, 1, 242, 168, 197, 212, 63, 244, 172, 203, 83, 3, 75, 45, 178, 161, 37, 95, 215, 86, 173, 201, 14, 210, 2, 119, 126, 165, 86, 73, 129, 4, 49, 11, 202, 168, 164, 4, 185, 145, 119, 40, 26, 114, 93, 255, 16, 94, 61, 14, 146, 49, 67, 132, 79, 174, 168, 106, 69, 201, 130, 246, 15, 25, 200, 22, 90, 162, 151, 52, 193, 138, 24, 167, 60, 255, 80, 5, 56, 125, 97, 84, 254, 151, 207, 201, 131, 255, 112, 98, 54, 194, 76, 65, 205, 194, 175, 68, 98, 82, 148, 127, 251, 251, 245, 95, 171, 207, 211, 138, 89, 213, 103, 238, 225, 212, 18, 45, 97, 187, 211, 9, 104, 215, 121, 98, 88, 91, 175, 194, 171, 117, 129, 80, 201, 126, 251, 125, 118, 140, 170, 64, 228, 190, 235, 135, 219, 122, 49, 161, 45, 183, 186, 94, 83, 40, 39, 31, 183, 12, 191, 36, 195, 126, 68, 66, 148, 165, 166, 98, 169, 173, 136, 45, 209, 238, 78, 174, 59, 237, 2, 174, 203, 183, 103, 43, 206, 142, 120, 24, 122, 92, 218, 220, 68, 215, 85, 237, 124, 91, 180, 247, 152, 18, 238, 118, 204, 240, 116, 2, 84, 163, 149, 133, 233, 103, 252, 51, 22, 9, 234, 70, 158, 70, 221, 218, 129, 219, 61, 58, 209, 175, 101, 118, 0, 186, 19, 101, 162, 157, 127, 51, 250, 212, 169, 118, 202, 140, 182, 248, 114, 101, 208, 214, 204, 20, 183, 136, 177, 14, 16, 180, 4, 160, 214, 144, 201, 113, 20, 171, 213, 28, 85, 153, 237, 219, 49, 21, 204, 164, 0, 207, 155, 152, 203, 40, 140, 55, 50, 148, 151, 84, 219, 8, 180, 238, 63, 137, 146, 157, 138, 31, 174, 97, 226, 105, 165, 1, 13, 186, 195, 203, 185, 153, 160, 36, 48, 97, 70, 247, 48, 47, 185, 38, 106, 30, 236, 234, 238, 241, 155, 104, 89, 178, 153, 117, 35, 16,};
    for (int i = 0; i < BLOCK_SIZE; i++) {
        T_ASSERT(a[i] == mem.memory[0].b[i]);
        T_ASSERT(b[i] == mem.memory[mem.col].b[i]);
        T_ASSERT(c[i] == mem.memory[mem.col + 1].b[i]);
    }
    res = argon2dHashRemaining(&in, mem);
    T_ASSERT(res == ARGON_RES_OK);
    uint8_t* out = argon2dFinalize(&in, mem,  &res);
    T_ASSERT(res == ARGON_RES_OK);
    T_ASSERT(out != NULL);
    uint8_t argon_expected_out[64] = { 180, 93, 57, 118, 172, 178, 167, 190, 223, 113, 124, 151, 193, 105, 44, 174, 60, 97, 47, 35, 44, 80, 1, 204, 25, 123, 48, 231, 76, 17, 124, 104, 82, 63, 240, 189, 120, 63, 19, 78, 67, 59, 215, 93, 1, 36, 45, 50, 245, 173, 30, 65, 200, 220, 96, 244, 14, 235, 61, 208, 187, 131, 235, 206 };
    for (int i = 0; i < 64; ++i) {
        T_ASSERT(out[i] == argon_expected_out[i]);
    }
    return T_SUCCESS;
}

int testArgonOutputMultiplePasses() {
    uint8_t exp_out[] = {149, 126, 184, 135, 180, 231, 16, 185, 37, 177, 207, 83, 215, 54, 55, 97, 51, 144, 158, 13, 128, 245, 213, 200, 110, 50, 128, 103, 101, 245, 207, 68, 223, 200, 165, 81, 110, 81, 253, 252, 220, 135, 146, 33, 16, 13, 184, 218, 90, 225, 163, 203, 201, 52, 153, 193, 121, 181, 147, 237, 5, 202, 137, 50};
    argon_input_t in = {
        .parallelism = 2,
        .mem_size = 128,
        .outlen = 64,
        .key = NULL,
        .key_len = 0,
        .message = "password",
        .message_len = strlen("password"),
        .salt = "RandomX3",
        .salt_len = strlen( "RandomX3"),
        .associated_data = NULL,
        .associated_data_len = 0,
        .passes = 2,
    };
    argon_m_matrix_t mem = argon2dAllocMatrix(&in);
    argon2dInitalHash(&in, mem);
    argon2dHashRemaining(&in, mem);
    argon_res_t res;
    uint8_t *o = argon2dFinalize(&in, mem, &res);
    for (int i = 0; i < 64; ++i) {
        T_ASSERT(o[i] == exp_out[i]);
    }
    return T_SUCCESS;
}
